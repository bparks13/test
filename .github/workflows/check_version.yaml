name: check_version
on:
  workflow_call:
    inputs:
      projectFile:
        required: true
        type: string

jobs:
  check_version:
    name: Check Version Number
    runs-on: ubuntu-latest
    environment: Testing

    steps:
      - name: Checkout current commit
        uses: actions/checkout@v4
        with:
          path: current
          sparse-checkout: ${{ inputs.projectFile }}

      - name: Checkout main
        uses: actions/checkout@v4
        with:
          ref: 'main'
          path: main
          sparse-checkout: ${{ inputs.projectFile }}

      - name: Find version numbers
        shell: bash
        run: |
          version_current=$(grep '<Version>' "./current/${{ inputs.projectFile }}" | grep -Eo "[0-9]+\.[0-9]+\.[0-9]+-?\w*")
          version_main=$(grep '<Version>' "./main/${{ inputs.projectFile }}" | grep -Eo "[0-9]+\.[0-9]+\.[0-9]+-?\w*")
          if [[ ! "$version_current" > "$version_main" ]]; then # TODO: Need to build this comparison out more, currently fails for 0.0.10 compared to 0.0.9
            echo "::error title=Invalid version number::Version number must be increased on pushes to main"
            exit 1
          fi
